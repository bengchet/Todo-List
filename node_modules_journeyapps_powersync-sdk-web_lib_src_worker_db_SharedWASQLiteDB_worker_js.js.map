{"version":3,"file":"node_modules_journeyapps_powersync-sdk-web_lib_src_worker_db_SharedWASQLiteDB_worker_js.js","mappings":"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,CAAC;AACP,CAAC,CAAC;AACFpB,KAAK,CAAC+B,SAAS,GAAG,UAAUC,KAAK,EAAE;EAC/B,MAAMC,IAAI,GAAGD,KAAK,CAACE,KAAK,CAAC,CAAC,CAAC;EAC3BN,OAAO,CAACC,KAAK,CAAC,qBAAqB,EAAEI,IAAI,CAAC;EAC1CrC,2CAAc,CAACS,MAAM,EAAE4B,IAAI,CAAC;AAChC,CAAC;AACDG,gBAAgB,CAAC,QAAQ,EAAE,MAAM;EAC7BC,KAAK,CAACC,IAAI,CAACpC,KAAK,CAACqC,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO,CAAEC,YAAY,IAAKhE,SAAS,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,aAAa;IAChG,IAAIgD,EAAE;IACN,MAAMT,EAAE,GAAG,MAAMyB,YAAY,CAACzB,EAAE;IAChC,CAACS,EAAE,GAAGT,EAAE,CAACO,KAAK,MAAM,IAAI,IAAIE,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACK,IAAI,CAACd,EAAE,CAAC;EACpE,CAAC,CAAC,CAAC;AACP,CAAC,CAAC;AACF;;;;;;UCzDA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;;;;WClCA;WACA;WACA;WACA;WACA,+BAA+B,wCAAwC;WACvE;WACA;WACA;WACA;WACA,iBAAiB,qBAAqB;WACtC;WACA;WACA,kBAAkB,qBAAqB;WACvC;WACA;WACA,KAAK;WACL;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WC3BA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WClBA;;WAEA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,aAAa;WACb;WACA;WACA;WACA;;WAEA;WACA;WACA;;WAEA;;WAEA;;;;;WCpCA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;UENA;UACA","sources":["webpack://PowerSync Angular Demo/./node_modules/@journeyapps/powersync-sdk-web/lib/src/worker/db/SharedWASQLiteDB.worker.js","webpack://PowerSync Angular Demo/webpack/bootstrap","webpack://PowerSync Angular Demo/webpack/runtime/chunk loaded","webpack://PowerSync Angular Demo/webpack/runtime/define property getters","webpack://PowerSync Angular Demo/webpack/runtime/ensure chunk","webpack://PowerSync Angular Demo/webpack/runtime/get javascript chunk filename","webpack://PowerSync Angular Demo/webpack/runtime/get mini-css chunk filename","webpack://PowerSync Angular Demo/webpack/runtime/global","webpack://PowerSync Angular Demo/webpack/runtime/hasOwnProperty shorthand","webpack://PowerSync Angular Demo/webpack/runtime/make namespace object","webpack://PowerSync Angular Demo/webpack/runtime/publicPath","webpack://PowerSync Angular Demo/webpack/runtime/importScripts chunk loading","webpack://PowerSync Angular Demo/webpack/runtime/startup chunk dependencies","webpack://PowerSync Angular Demo/webpack/before-startup","webpack://PowerSync Angular Demo/webpack/startup","webpack://PowerSync Angular Demo/webpack/after-startup"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport '@journeyapps/wa-sqlite';\nimport * as Comlink from 'comlink';\nimport { v4 as uuid } from 'uuid';\nimport { _openDB } from './open-db';\nconst _self = self;\nconst DBMap = new Map();\nconst OPEN_DB_LOCK = 'open-wasqlite-db';\nconst openDB = (dbFileName) => __awaiter(void 0, void 0, void 0, function* () {\n    // Prevent multiple simultaneous opens from causing race conditions\n    return navigator.locks.request(OPEN_DB_LOCK, () => __awaiter(void 0, void 0, void 0, function* () {\n        const clientId = uuid();\n        if (!DBMap.has(dbFileName)) {\n            const clientIds = new Set();\n            const connection = yield _openDB(dbFileName);\n            DBMap.set(dbFileName, {\n                clientIds,\n                db: connection\n            });\n        }\n        const dbEntry = DBMap.get(dbFileName);\n        dbEntry.clientIds.add(clientId);\n        const { db } = dbEntry;\n        const wrappedConnection = Object.assign(Object.assign({}, db), { close: Comlink.proxy(() => {\n                var _a;\n                const { clientIds } = dbEntry;\n                clientIds.delete(clientId);\n                if (clientIds.size == 0) {\n                    console.debug(`Closing connection to ${dbFileName}.`);\n                    DBMap.delete(dbFileName);\n                    return (_a = db.close) === null || _a === void 0 ? void 0 : _a.call(db);\n                }\n                console.debug(`Connection to ${dbFileName} not closed yet due to active clients.`);\n            }) });\n        return Comlink.proxy(wrappedConnection);\n    }));\n});\n_self.onconnect = function (event) {\n    const port = event.ports[0];\n    console.debug('Exposing db on port', port);\n    Comlink.expose(openDB, port);\n};\naddEventListener('unload', () => {\n    Array.from(DBMap.values()).forEach((dbConnection) => __awaiter(void 0, void 0, void 0, function* () {\n        var _a;\n        const db = yield dbConnection.db;\n        (_a = db.close) === null || _a === void 0 ? void 0 : _a.call(db);\n    }));\n});\n//# sourceMappingURL=SharedWASQLiteDB.worker.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [\"vendors-node_modules_comlink_dist_esm_comlink_mjs-node_modules_babel_runtime_helpers_esm_asyn-8dcd04\",\"vendors-node_modules_journeyapps_powersync-sdk-web_lib_src_worker_db_open-db_js\"], () => (__webpack_require__(\"./node_modules/@journeyapps/powersync-sdk-web/lib/src/worker/db/SharedWASQLiteDB.worker.js\")))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = self.location + \"\";\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t\"node_modules_journeyapps_powersync-sdk-web_lib_src_worker_db_SharedWASQLiteDB_worker_js\": 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkPowerSync_Angular_Demo\"] = self[\"webpackChunkPowerSync_Angular_Demo\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([\n\t\t__webpack_require__.e(\"vendors-node_modules_comlink_dist_esm_comlink_mjs-node_modules_babel_runtime_helpers_esm_asyn-8dcd04\"),\n\t\t__webpack_require__.e(\"vendors-node_modules_journeyapps_powersync-sdk-web_lib_src_worker_db_open-db_js\")\n\t]).then(next);\n};","","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n",""],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Comlink","v4","uuid","_openDB","_self","self","DBMap","Map","OPEN_DB_LOCK","openDB","dbFileName","navigator","locks","request","clientId","has","clientIds","Set","connection","set","db","dbEntry","get","add","wrappedConnection","Object","assign","close","proxy","_a","delete","size","console","debug","call","onconnect","event","port","ports","expose","addEventListener","Array","from","values","forEach","dbConnection"],"sourceRoot":""}